# data.azurerm_resource_group.azure_resource_group_image_gallery:
data "azurerm_resource_group" "azure_resource_group_image_gallery" {
    id         = "/subscriptions/18573a3d-bbfc-45f7-9912-cfa159ecd0f5/resourceGroups/rg-mvd-core-ch-001"
    location   = "switzerlandnorth"
    managed_by = [90mnull[0m[0m
    name       = "rg-mvd-core-ch-001"
    tags       = {}
}

# data.azurerm_resource_group.azure_resource_group_main:
data "azurerm_resource_group" "azure_resource_group_main" {
    id         = "/subscriptions/18573a3d-bbfc-45f7-9912-cfa159ecd0f5/resourceGroups/rg-mvd-m020-ch-001"
    location   = "switzerlandnorth"
    managed_by = [90mnull[0m[0m
    name       = "rg-mvd-m020-ch-001"
    tags       = {
        "Cost_Center_tag"  = "99999"
        "Function"         = "Managed Virtual Desktop"
        "TerraformVersion" = ">=1.5"
        "environment_tag"  = "P"
        "source"           = "terraform"
    }
}

# data.azurerm_shared_image_gallery.azure_image_gallery_main:
data "azurerm_shared_image_gallery" "azure_image_gallery_main" {
    description         = "Shared Image Gallery for Windows images"
    id                  = "/subscriptions/18573a3d-bbfc-45f7-9912-cfa159ecd0f5/resourceGroups/rg-mvd-core-ch-001/providers/Microsoft.Compute/galleries/gal_mvd_sta_ch_02"
    image_names         = [
        "m01_T_VDI_MCS__xsk78",
        "sta-svr-19-23h2-std-cor-gen-001",
        "sta-svr-19-23h2-std-cor-spe-001",
        "sta-svr-22-23h2-std-cor-gen-001",
        "sta-svr-22-23h2-std-cor-spe-001",
        "sta-win-11-23h2-avd-cor-ctx-001",
        "sta-win-11-23h2-avd-ctx-gen-001",
        "sta-win-11-23h2-pro-ctx-gen-001",
        "sta-win-11-23h2-pro-ctx-spe-001",
    ]
    location            = "switzerlandnorth"
    name                = "gal_mvd_sta_ch_02"
    resource_group_name = "rg-mvd-core-ch-001"
    tags                = {
        "CostCenter"   = "mcore"
        "CreationDate" = "2025-05-03"
        "Environment"  = "dev"
        "ManagedBy"    = "Terraform"
        "Owner"        = "SIT Team"
        "Project"      = "Azure Image Gallery"
        "Purpose"      = "Shared Windows Images"
    }
    unique_name         = "18573a3d-bbfc-45f7-9912-cfa159ecd0f5-GAL_MVD_STA_CH_02"
}

# data.azurerm_subnet.azure_subnet_main:
data "azurerm_subnet" "azure_subnet_main" {
    address_prefix                                = "10.20.0.0/24"
    address_prefixes                              = [
        "10.20.0.0/24",
    ]
    default_outbound_access_enabled               = true
    id                                            = "/subscriptions/18573a3d-bbfc-45f7-9912-cfa159ecd0f5/resourceGroups/rg-mvd-m020-ch-001/providers/Microsoft.Network/virtualNetworks/vnet-m020-ch-001/subnets/snet-m020-ch-001"
    name                                          = "snet-m020-ch-001"
    network_security_group_id                     = "/subscriptions/18573a3d-bbfc-45f7-9912-cfa159ecd0f5/resourceGroups/rg-mvd-m020-ch-001/providers/Microsoft.Network/networkSecurityGroups/nsg-m020-ch-001"
    private_endpoint_network_policies             = "Disabled"
    private_link_service_network_policies_enabled = true
    resource_group_name                           = "rg-mvd-m020-ch-001"
    route_table_id                                = [90mnull[0m[0m
    service_endpoints                             = []
    virtual_network_name                          = "vnet-m020-ch-001"
}

# data.azurerm_virtual_machine.azure_virtual_machine_profile:
data "azurerm_virtual_machine" "azure_virtual_machine_profile" {
    id                   = "/subscriptions/18573a3d-bbfc-45f7-9912-cfa159ecd0f5/resourceGroups/rg-mvd-m020-ch-001/providers/Microsoft.Compute/virtualMachines/mvd020050001"
    identity             = []
    location             = "switzerlandnorth"
    name                 = "mvd020050001"
    power_state          = "deallocated"
    private_ip_address   = "10.20.0.5"
    private_ip_addresses = [
        "10.20.0.5",
    ]
    public_ip_address    = [90mnull[0m[0m
    public_ip_addresses  = []
    resource_group_name  = "rg-mvd-m020-ch-001"
}

# data.citrix_zone.citrix_daas_zone_main:
data "citrix_zone" "citrix_daas_zone_main" {
    id   = "b456e68d-c538-4e34-8c51-cc9c711e01a5"
    name = "mvd-020-p-azure"
}

# data.gitlab_project.gitlab_project_main:
data "gitlab_project" "gitlab_project_main" {
    allow_pipeline_trigger_approve_deployment   = false
    analytics_access_level                      = "enabled"
    archived                                    = false
    auto_cancel_pending_pipelines               = "enabled"
    auto_devops_deploy_strategy                 = "continuous"
    auto_devops_enabled                         = false
    autoclose_referenced_issues                 = false
    build_git_strategy                          = "fetch"
    build_timeout                               = 3600
    builds_access_level                         = "enabled"
    ci_config_path                              = [90mnull[0m[0m
    ci_default_git_depth                        = 20
    ci_delete_pipelines_in_seconds              = 0
    ci_id_token_sub_claim_components            = [
        "project_path",
        "ref_type",
        "ref",
    ]
    ci_pipeline_variables_minimum_override_role = "developer"
    ci_restrict_pipeline_cancellation_role      = [90mnull[0m[0m
    ci_separated_caches                         = true
    container_expiration_policy                 = [
        {
            cadence           = "1d"
            enabled           = false
            keep_n            = 10
            name_regex_delete = ".*"
            name_regex_keep   = [90mnull[0m[0m
            next_run_at       = "2025-07-23T04:13:05Z"
            older_than        = "90d"
        },
    ]
    container_registry_access_level             = "enabled"
    default_branch                              = "main"
    description                                 = [90mnull[0m[0m
    emails_enabled                              = true
    empty_repo                                  = false
    environments_access_level                   = "enabled"
    external_authorization_classification_label = [90mnull[0m[0m
    feature_flags_access_level                  = "enabled"
    forking_access_level                        = "enabled"
    http_url_to_repo                            = "https://gitlab.com/sintes/do/mvd-azu/vm-deployment.git"
    id                                          = "71817446"
    import_url                                  = [90mnull[0m[0m
    infrastructure_access_level                 = "enabled"
    issues_access_level                         = "enabled"
    issues_enabled                              = true
    keep_latest_artifact                        = true
    merge_commit_template                       = [90mnull[0m[0m
    merge_pipelines_enabled                     = false
    merge_requests_access_level                 = "enabled"
    merge_requests_enabled                      = true
    merge_trains_enabled                        = false
    model_experiments_access_level              = "enabled"
    model_registry_access_level                 = "enabled"
    monitor_access_level                        = "enabled"
    name                                        = "vm-deployment"
    namespace_id                                = 111289134
    path                                        = "vm-deployment"
    path_with_namespace                         = "sintes/do/mvd-azu/vm-deployment"
    pipelines_enabled                           = true
    prevent_merge_without_jira_issue            = false
    public_builds                               = true
    push_rules                                  = []
    releases_access_level                       = "enabled"
    remove_source_branch_after_merge            = true
    repository_access_level                     = "enabled"
    repository_storage                          = [90mnull[0m[0m
    request_access_enabled                      = true
    requirements_access_level                   = "enabled"
    resolve_outdated_diff_discussions           = false
    restrict_user_defined_variables             = false
    runners_token                               = (sensitive value)
    security_and_compliance_access_level        = "private"
    shared_with_groups                          = []
    snippets_access_level                       = "enabled"
    snippets_enabled                            = true
    squash_commit_template                      = [90mnull[0m[0m
    ssh_url_to_repo                             = "git@gitlab.com:sintes/do/mvd-azu/vm-deployment.git"
    suggestion_commit_message                   = [90mnull[0m[0m
    topics                                      = [
        "managed-by-soos",
    ]
    visibility_level                            = "private"
    web_url                                     = "https://gitlab.com/sintes/do/mvd-azu/vm-deployment"
    wiki_access_level                           = "enabled"
    wiki_enabled                                = true
}

# data.gitlab_project_variable.gitlab_variable_windows_password:
data "gitlab_project_variable" "gitlab_variable_windows_password" {
    description       = [90mnull[0m[0m
    environment_scope = "*"
    id                = "71817446:windows_admin_password_020:*"
    key               = "windows_admin_password_020"
    masked            = true
    project           = "71817446"
    protected         = true
    raw               = false
    value             = "FqAnA2Dm~/54hn1hGFK:8tIO"
    variable_type     = "env_var"
}

# citrix_service_account.sc_for_machine_id_domain:
resource "citrix_service_account" "sc_for_machine_id_domain" {
    account_id                   = "m020\\azureuser"
    account_secret               = (sensitive value)
    account_secret_format        = "PlainText"
    description                  = [90mnull[0m[0m
    display_name                 = "az-ch-svc-m020-001"
    id                           = "f047c197-8578-4dcd-9a2d-00449ed93942"
    identity_provider_identifier = "m020.abxcloud.ch"
    identity_provider_type       = "ActiveDirectory"
    scopes                       = []
}


# module.citrix_daas_application_folder.citrix_admin_folder.main:
resource "citrix_admin_folder" "main" {
    id                       = "8"
    name                     = "M020"
    path                     = "M020"
    total_application_groups = 0
    total_applications       = 0
    total_delivery_groups    = 0
    total_machine_catalogs   = 0
    type                     = [
        "ContainsApplicationGroups",
        "ContainsApplications",
        "ContainsDeliveryGroups",
        "ContainsMachineCatalogs",
    ]
}


# module.citrix_daas_hypervisor_azure.citrix_azure_hypervisor.hypervisor:
resource "citrix_azure_hypervisor" "hypervisor" {
    active_directory_id                        = "bfb830fa-7890-4254-80ee-46b0fc2add3b"
    application_id                             = "6f93f7c6-b851-4461-ae42-b5e72dcc9d6d"
    application_secret                         = (sensitive value)
    authentication_mode                        = "AppClientSecret"
    enable_azure_ad_device_management          = false
    id                                         = "5be975e5-7449-45b9-a432-8efe7f61d951"
    name                                       = "az-ch-hyp-m020-001"
    proxy_hypervisor_traffic_through_connector = false
    scopes                                     = []
    subscription_id                            = "18573a3d-bbfc-45f7-9912-cfa159ecd0f5"
    zone                                       = "b456e68d-c538-4e34-8c51-cc9c711e01a5"
}

# module.citrix_daas_hypervisor_azure.citrix_azure_hypervisor_resource_pool.resource_pool:
resource "citrix_azure_hypervisor_resource_pool" "resource_pool" {
    hypervisor                     = "5be975e5-7449-45b9-a432-8efe7f61d951"
    id                             = "881f889f-76f9-4bdb-ab0a-67b828fe9ba4"
    name                           = "vnet-020-ch-001"
    region                         = "Switzerland North"
    subnets                        = [
        "snet-m020-ch-001",
    ]
    virtual_network                = "vnet-m020-ch-001"
    virtual_network_resource_group = "rg-mvd-m020-ch-001"
    vm_tagging                     = true
}

# module.citrix_daas_hypervisor_azure.null_resource.wait_after_hypervisor:
resource "null_resource" "wait_after_hypervisor" {
    id = "4453460891622042325"
}


# module.citrix_image_hsd.citrix_image_definition.hsd:
resource "citrix_image_definition" "hsd" {
    azure_image_definition   = {
        image_gallery_name = "gal_mvd_sta_ch_02"
        resource_group     = "rg-mvd-core-ch-001"
        use_image_gallery  = true
    }
    description              = "Windows Server 2022 HSD Multi Session Image für Mandant 020"
    hypervisor               = "5be975e5-7449-45b9-a432-8efe7f61d951"
    hypervisor_resource_pool = "881f889f-76f9-4bdb-ab0a-67b828fe9ba4"
    id                       = "4311e460-6791-4dad-8f9e-683aba3aa8c9"
    latest_version           = 0
    name                     = "020-S-HSD-MCS-NON-ADJ-AZU-SIT-001"
    os_type                  = "Windows"
    session_support          = "MultiSession"
}

# module.citrix_image_hsd.citrix_image_version.hsd_multi["hsd_stable"]:
resource "citrix_image_version" "hsd_multi" {
    azure_image_specs        = {
        gallery_image    = {
            definition = "sta-svr-22-23h2-std-cor-spe-001"
            gallery    = "gal_mvd_sta_ch_02"
            version    = "2025.0922.0706"
        }
        machine_profile  = {
            machine_profile_resource_group = "rg-mvd-m020-ch-001"
            machine_profile_vm_name        = "mvd020050001"
        }
        resource_group   = "rg-mvd-core-ch-001"
        service_offering = "Standard_D2s_v3"
        storage_type     = "Premium_LRS"
    }
    description              = "Stable HSD version for production workloads"
    hypervisor               = "5be975e5-7449-45b9-a432-8efe7f61d951"
    hypervisor_resource_pool = "881f889f-76f9-4bdb-ab0a-67b828fe9ba4"
    id                       = "260c3f97-55d6-4961-bdd6-c54224df2013"
    image_definition         = "4311e460-6791-4dad-8f9e-683aba3aa8c9"
    os_type                  = "Windows"
    session_support          = "MultiSession"
    version_number           = 1
}
